# Балансировщик нагрузки с ограничением запросов

Проект реализует балансировщик нагрузки с возможностью ограничения запросов (rate limiting) на языке Go. Распределяет HTTP-запросы между несколькими бэкенд-серверами с настраиваемыми ограничениями скорости.

## Возможности

- **Балансировка нагрузки** по алгоритму Round-robin
- **Проверка здоровья** бэкенд-серверов
- **Ограничение запросов** по алгоритму Token Bucket
  - Глобальные ограничения по умолчанию
  - Индивидуальные ограничения для клиентов
  - Настраиваемый интервал пополнения
- **Обратный прокси** для перенаправления запросов
- **Конфигурация** через YAML-файл

## Конфигурация

Система настраивается через файл `config/config.yaml`:

```yaml
port: 8080
backends:
  - url: "http://backend1:8080"
    healthy: true
  - url: "http://backend2:8080"
    healthy: true

rate_limiter:
  default_capacity: 100    # Максимальное количество запросов
  default_rate: 10         # Скорость пополнения (запросов в секунду)
  refill_interval: 1s      # Интервал пополнения
  client_specific:         # Индивидуальные настройки для клиентов
    "192.168.1.1":
      capacity: 200
      rate: 20
    "10.0.0.5":
      capacity: 50
      rate: 5
```      
## Архитектура

Основные компоненты системы:

- Балансировщик - Реализует алгоритм 
- Round-robin с проверкой здоровья серверов   
- Ограничитель запросов - Реализация алгоритма Token Bucket
- Прокси - Обратный прокси для п еренаправления запросов
-Сервер - HTTP-сервер с middleware для ограничения запросов

## Запуск проекта

Требования

Go версии 1.24+
Docker (для тестовых бэкендов)

### Запуск приложения

1. Сборка и запуск через Docker:
```bash
docker-compose up --build
```
Или напрямую через Go:
```bash
go run main.go
```
Балансировщик будет доступен по адресу http://localhost:8080.

## Тестирование

Запуск unit-тестов:

```bash
go test ./...
```

Запуск бенчмарков:
```bash
go test -bench=. ./...
```
## API Endpoints

- / - Перенаправляет запросы на бэкенд-серверы
- /health - Проверка работоспособности (возвращает 200 при успехе)

## Ограничение запросов

Система использует алгоритм Token Bucket:

- Каждый клиент имеет "ведро" с токенами
- Каждый запрос расходует один токен
- Токены пополняются с заданной скоростью
- При отсутствии токенов запросы отклоняются с кодом 429